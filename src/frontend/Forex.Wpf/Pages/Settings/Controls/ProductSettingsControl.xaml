<UserControl x:Class="Forex.Wpf.Pages.Settings.Controls.ProductSettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
             xmlns:resConverters="clr-namespace:Forex.Wpf.Resources.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">

	<UserControl.Resources>
        <Style x:Key="InputTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#DDDDDD" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Height" Value="40" />
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource PrimaryHueMidBrush}" />
                    <Setter Property="BorderThickness" Value="2" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SearchTextBoxStyle" TargetType="TextBox" BasedOn="{StaticResource InputTextBoxStyle}">
            <Setter Property="md:HintAssist.Hint" Value="ðŸ” Qidirish (Kod yoki Nom)" />
            <Setter Property="md:HintAssist.IsFloating" Value="False" />
            <Setter Property="Foreground" Value="#333333" />
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
            <Setter Property="Margin" Value="0 0 0 12"/>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="md:ButtonAssist.CornerRadius" Value="4"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Background="AliceBlue"
                CornerRadius="8"
                Padding="15"
                md:ElevationAssist.Elevation="Dp2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Mahsulotlar" Style="{StaticResource SectionHeaderStyle}"/>

                <Button Grid.Row="1" 
                        Content="âž• Yangi Mahsulot"
                        Command="{Binding AddProductCommand}"
                        Style="{StaticResource ActionButtonStyle}"
                        HorizontalAlignment="Stretch"
                        Padding="5"
                        Margin="0 0 0 12"/>

                <TextBox Grid.Row="2"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource SearchTextBoxStyle}"
                         Margin="0 0 0 12"/>

                <ListBox Grid.Row="3"
                         ItemsSource="{Binding ProductsView}"
                         SelectedItem="{Binding SelectedProduct}"
                         BorderThickness="0"
                         Background="Transparent"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                <Border Width="50" Height="50"
                                        CornerRadius="4"
                                        Margin="0 0 12 0">
									<Border.Background>
										<ImageBrush ImageSource="{Binding ImagePath, Converter={StaticResource UniversalImageResolver}}"
                                           Stretch="UniformToFill"/>
									</Border.Background>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Name}" 
                                               FontWeight="Medium" 
                                               FontSize="14"
                                               TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding Code}" 
                                               FontSize="12" 
                                               Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

		<Border Grid.Column="2"
        Background="AliceBlue"
        CornerRadius="8"
        Padding="15"
        md:ElevationAssist.Elevation="Dp2"
        Visibility="{Binding HasSelectedProduct, Converter={StaticResource BoolToVisibilityConverter}}">

			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Margin="0,0,0,15">
					<StackPanel>
						<TextBlock Text="Rasm" Style="{StaticResource SectionHeaderStyle}"/>
						<StackPanel Orientation="Horizontal" Margin="0 0 0 20">
							<Border Width="140" Height="140" CornerRadius="8" Margin="0 0 16 0">
								<Border.Background>
									<ImageBrush ImageSource="{Binding SelectedProduct.ImagePath, Converter={StaticResource UniversalImageResolver}}" Stretch="UniformToFill"/>
								</Border.Background>
							</Border>
							<StackPanel VerticalAlignment="Center">
								<Button Content="ðŸ“· Rasm Yuklash" Command="{Binding UploadImageCommand}" Style="{StaticResource MaterialDesignRaisedButton}" md:ButtonAssist.CornerRadius="4" Height="32" Margin="0 0 0 10"/>
								<Button Content="ðŸ—‘ Rasmni O'chirish" Command="{Binding DeleteImageCommand}" Style="{StaticResource MaterialDesignOutlinedButton}" md:ButtonAssist.CornerRadius="4" Height="32" Foreground="#D32F2F" BorderBrush="#D32F2F"/>
							</StackPanel>
						</StackPanel>

						<TextBlock Text="Asosiy Ma'lumotlar" Style="{StaticResource SectionHeaderStyle}"/>
						<Grid Margin="0 0 0 20">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="16"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<StackPanel Grid.Column="0">
								<TextBlock Text="Mahsulot Kodi" FontSize="12" FontWeight="Medium" Foreground="#666666" Margin="0 0 0,4"/>
								<TextBox Text="{Binding SelectedProduct.Code, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InputTextBoxStyle}"/>
							</StackPanel>
							<StackPanel Grid.Column="2">
								<TextBlock Text="Mahsulot Nomi" FontSize="12" FontWeight="Medium" Foreground="#666666" Margin="0 0 0,4"/>
								<TextBox Text="{Binding SelectedProduct.Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InputTextBoxStyle}"/>
							</StackPanel>
						</Grid>

						<TextBlock Text="Mahsulot Turlari (Razmerlar)" Style="{StaticResource SectionHeaderStyle}"/>
						<Button Content="âž• Yangi Tur Qo'shish" Command="{Binding AddProductTypeCommand}" Style="{StaticResource MaterialDesignOutlinedButton}" md:ButtonAssist.CornerRadius="4" HorizontalAlignment="Left" Height="36" Padding="16 0" Margin="0 0 0 12"/>

						<DataGrid ItemsSource="{Binding SelectedProduct.ProductTypes}" VerticalContentAlignment="Center" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" HeadersVisibility="Column" GridLinesVisibility="Horizontal" BorderThickness="1" BorderBrush="#DDDDDD" MaxHeight="250" Margin="0 0 0 20">
							<DataGrid.Columns>
								<DataGridTextColumn Header="Tur (Razmer)" Binding="{Binding Type, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
								<DataGridTemplateColumn Header="Dona/Bog'" Width="*">
									<DataGridTemplateColumn.CellTemplate>
										<DataTemplate>
											<TextBox Text="{Binding BundleItemCount, UpdateSourceTrigger=PropertyChanged}"
											         IsReadOnly="{Binding CanEditBundleCount, Converter={StaticResource InverseBoolConverter}}"
											         BorderThickness="0"
											         Background="Transparent"
											         VerticalContentAlignment="Center"
											         Padding="12,0"/>
										</DataTemplate>
									</DataGridTemplateColumn.CellTemplate>
								</DataGridTemplateColumn>
								<DataGridTextColumn Header="Narxi" Binding="{Binding UnitPrice, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
								<DataGridTemplateColumn Width="65">
									<DataGridTemplateColumn.CellTemplate>
										<DataTemplate>
											<Button Command="{Binding DataContext.DeleteProductTypeCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource MaterialDesignIconButton}" ToolTip="O'chirish" Width="32" Height="32">
												<fa:IconImage Icon="Trash" Width="14" Foreground="#D32F2F"/>
											</Button>
										</DataTemplate>
									</DataGridTemplateColumn.CellTemplate>
								</DataGridTemplateColumn>
							</DataGrid.Columns>
						</DataGrid>
					</StackPanel>
				</ScrollViewer>

				<Border Grid.Row="1" Padding="0,10,0,0" BorderBrush="#EEEEEE" BorderThickness="0,1,0,0">
					<StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
						<Button Content="ðŸ’¾ Saqlash"
                                Command="{Binding SaveProductCommand}"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                md:ButtonAssist.CornerRadius="4"
                                Height="40" Padding="24 0" Margin="0 0 12 0"/>
						<Button Content="ðŸ—‘ Mahsulotni O'chirish"
                                Command="{Binding DeleteProductCommand}"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                md:ButtonAssist.CornerRadius="4"
                                Height="40" Padding="20 0"
                                Foreground="#D32F2F" BorderBrush="#D32F2F"/>
					</StackPanel>
				</Border>
			</Grid>
		</Border>

		<Border Grid.Column="2" 
                Background="AliceBlue"
                CornerRadius="8"
                md:ElevationAssist.Elevation="Dp2"
                Visibility="{Binding HasSelectedProduct, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <fa:IconImage Icon="BoxOpen" Width="64" Foreground="Gray"/>
                <TextBlock Text="Tahrirlash uchun mahsulot tanlang"
                           FontSize="14"
                           Foreground="Gray"
                           Margin="0 12 0 0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
