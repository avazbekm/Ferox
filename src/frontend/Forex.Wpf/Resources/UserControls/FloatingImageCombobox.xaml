<UserControl x:Class="Forex.Wpf.Resources.UserControls.FloatingImageComboBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             x:Name="Root"
             Height="30"
             d:DesignHeight="32"
             d:DesignWidth="150"
             mc:Ignorable="d">

	<Grid>
		<TextBlock HorizontalAlignment="Center"
                   FontSize="14"
                   Foreground="{DynamicResource PrimaryTextColor}"
                   Style="{StaticResource FloatingLabelStyle}"
                   Tag="{Binding ElementName=combo}"
                   Text="{Binding Label, ElementName=Root}"/>

		<Border Height="30"
                Padding="5,0"
                VerticalAlignment="Bottom"
                BorderBrush="{DynamicResource PrimaryTextColor}"
                BorderThickness="1"
                CornerRadius="4">

			<ComboBox x:Name="combo"
                  VerticalAlignment="Center"
                  Background="Transparent"
                  BorderThickness="0"
                  FontSize="14"
                  IsEditable="{Binding IsEditable, ElementName=Root}"
				  TextSearch.TextPath="{Binding PrimaryTextMemberPath, ElementName=Root}"
                  ItemsSource="{Binding ItemsSource, ElementName=Root}"
                  SelectedItem="{Binding SelectedItem, ElementName=Root, Mode=TwoWay}"
                  Text="{Binding Text, ElementName=Root, Mode=TwoWay}"
                  GotFocus="ComboBox_GotFocus">

			<ComboBox.Resources>
				<Storyboard x:Key="ScaleUpStoryboard">
					<DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
									 Duration="0:0:0.2">
						<DoubleAnimation.EasingFunction>
							<QuadraticEase EasingMode="EaseOut"/>
						</DoubleAnimation.EasingFunction>
					</DoubleAnimation>
					<DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
									 Duration="0:0:0.2">
						<DoubleAnimation.EasingFunction>
							<QuadraticEase EasingMode="EaseOut"/>
						</DoubleAnimation.EasingFunction>
					</DoubleAnimation>
				</Storyboard>
				<Storyboard x:Key="ScaleDownStoryboard">
					<DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleX"
									 To="1"
									 Duration="0:0:0.15">
						<DoubleAnimation.EasingFunction>
							<QuadraticEase EasingMode="EaseIn"/>
						</DoubleAnimation.EasingFunction>
					</DoubleAnimation>
					<DoubleAnimation Storyboard.TargetProperty="RenderTransform.ScaleY"
									 To="1"
									 Duration="0:0:0.15">
						<DoubleAnimation.EasingFunction>
							<QuadraticEase EasingMode="EaseIn"/>
						</DoubleAnimation.EasingFunction>
					</DoubleAnimation>
				</Storyboard>
			</ComboBox.Resources>

			<ComboBox.ItemContainerStyle>
				<Style TargetType="ComboBoxItem">
						<Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
					</Style>
			</ComboBox.ItemContainerStyle>

			<ComboBox.ItemTemplate>
					<DataTemplate>
						<Grid Margin="2">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<Border x:Name="ImgBorder" 
                                    Width="{Binding ImageWidth, ElementName=Root}"
                                    Height="{Binding ImageHeight, ElementName=Root}"
                                    CornerRadius="{Binding ImageCornerRadius, ElementName=Root}"
                                    ClipToBounds="True" Margin="0,0,10,0"
                                    Visibility="{Binding ShowImage, ElementName=Root, Converter={StaticResource BoolToVisibilityConverter}}">
								<Image Stretch="UniformToFill">
									<Image.Source>
										<MultiBinding Converter="{StaticResource UniversalImageResolver}">
											<Binding Path="." />
											<Binding Path="ImageMemberPath" ElementName="Root" />
										</MultiBinding>
									</Image.Source>
								</Image>
							</Border>

							<StackPanel Grid.Column="1" VerticalAlignment="Center">
								<TextBlock FontWeight="Bold" FontSize="13">
									<TextBlock.Text>
										<MultiBinding Converter="{StaticResource UniversalImageResolver}">
											<Binding Path="." />
											<Binding Path="PrimaryTextMemberPath" ElementName="Root" />
										</MultiBinding>
									</TextBlock.Text>
								</TextBlock>
								<TextBlock x:Name="SecTxt" FontSize="11" Foreground="Gray">
									<TextBlock.Text>
										<MultiBinding Converter="{StaticResource UniversalImageResolver}">
											<Binding Path="." />
											<Binding Path="SecondaryTextMemberPath" ElementName="Root" />
										</MultiBinding>
									</TextBlock.Text>
								</TextBlock>
							</StackPanel>
						</Grid>
						<DataTemplate.Triggers>
							<DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ComboBoxItem}}" Value="{x:Null}">
								<Setter TargetName="ImgBorder" Property="Visibility" Value="Collapsed"/>
								<Setter TargetName="SecTxt" Property="Visibility" Value="Collapsed"/>
							</DataTrigger>
						</DataTemplate.Triggers>
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>
		</Border>
	</Grid>
</UserControl>